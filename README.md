# 电影微信公众号开发

本次是针对服务号/订阅号的开发，下一步会打通微信小程序及微信支付模块

1、主要用到的技术栈：

* 后端：node+koa2+mongodb+es6 前端：vue+jquery+weui

2、主要功能有：

* 支持语音或文字回复进行搜索电影
* 自定义菜单
* 模板发送消息
* 图文信息回复
* 网页授权登录获取用户资料
* 网页调用微信jssdk，实现自定义分享、图片预览、语音识别、查看地理位置等功能
* 电影详情用户收藏
* 个人主页显示用户微信头像及昵称和用户收藏的电影列表

3、通过这次学习微信公众号开发，我总结下面几点问题

* 首先你的公众号要认证，才能获取高级接口的调用，微信支付只能是企业资格申请(个人暂时不允许)
* 服务器域名要备案，在开发阶段可以用内网穿透代理工具(花生壳、魔法隧道、ngorck等工具)
* access_token问题，全局的，局部的，很容易造成混乱，2小时失效
* 如果涉及要打通订阅号、服务号、企业号、小程序，就要使用UnionID，微信开放平台（open.weixin.qq.com）绑定公众号后使用

4、access_token问题

* 全局access_token是调用微信基础接口的唯一标识，也就是一个全局票据，一天最多发起2000次请求
  所以一定要缓存，在距离5分钟失效的时候就要再次发起请求，重新替换久的
* 在用户授权登录的时候也需要有access_token,跟全局的access_token完全不一样，有新的接口地址获取
* 在调用jssdk的时候，服务端需要先验证签名，签名之前要先获取jsapi_ticket，ticket的获取也是需要token的
  这个token就是全局缓存的token
* jsapi_ticket也是有2小时失效，也是需要缓存起来的
